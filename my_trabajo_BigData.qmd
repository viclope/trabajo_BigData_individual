---
title: "![](imagenes/F1logo.png) Big Data de la F1"
description: |
  La Formula 1 mola: Análisis superficiales de este deporte de motor
author:
  - name: Víctor Cloquell
    affiliation: Universitat de València
    affiliation-url: https://www.uv.es
date: 2026-01-07                          #--
categories: [trabajo BigData, f1, la 33]   #--
image: "./imagenes/parrilla_salida.jpeg"
title-block-banner: "#000000"   #- {true, false, "green","#AA0000"}
title-block-banner-color: "#FFFFFF"   #-"#FFFFFF" 
toc-depth: 3
smooth-scroll: true
format: 
  html:
    #backgroundcolor: "#F1F3F4"
    #embed-resources: true
    link-external-newwindow: true
    #css: assets/my_css_file.css   #- CUIDADO!!!!
code-tools: true
code-link: true
code-fold: true
---

## Introducción

El objetivo de este trabajo es investigar un poco sobre los datos que nos puede proporcionar el mundo de la automoción, en concreto, el Campeonato de Fórmula 1 que es considerado como la máxima categoría del automovilismo a nivel mundial y uno de los deportes más seguidos con millones de seguidores por todo el planeta. En la actualidad, no solo representa una competencia deportiva, sino también un laboratorio de desarrollo tecnológico y una industria global que genera grandes ingresos y es una gran plataforma de marketing para las prestigiosas marcas.

------------------------------------------------------------------------

## Datos del trabajo 

Los datos los he obtenido de varias páginas webs: OpenDataBay, Kaggle y Github, conocidas por sus ingentes archivos recopilatorios de temas muy diversos entre sí. Finalmente escogí 5 bases distintas cada uno para una funcionalidad en particular.

```{r}
library(tidyverse)
library(readr)
library(gt)
library(gtExtras)
library(ggthemes)
library(dplyr)
library(patchwork)
library(ggplot2)
library(rnaturalearth)
library(rnaturalearthdata)
library(treemap)
library(highcharter) 

df_clas_pil <- read.csv("Datos/drivers.csv")
df_clas_esc <- read.csv("Datos/teams.csv")
df_gan_car <- read.csv("Datos/ganadores_cada_carrera.csv")
df_vue_rap <- read.csv("Datos/GrandPrix_fastest_laps_details_1950_to_2022.csv")
df_pit_stops <- read.csv("Datos/f1_pit_stop_summary.csv")

```

------------------------------------------------------------------------

## Clasificación

Para calentar con el análisis, voy a hacer una tabla sobre la última clasificación general de pilotos y escuderías disponible, y esa es la temporada 2024. 

### Resultado de pilotos

```{r}
df_clas_pil <- read.csv("Datos/drivers.csv") %>%
               filter(year == 2024) %>%
               select(-year)

df_pil_fotos <- df_clas_pil %>%
  mutate(
    foto = c("https://formula1.lne.es/media/pilotos/medium/max-verstappen.jpg?ttt2023",
             "https://formula1.lne.es/media/pilotos/medium/lando-norris.jpg?ttt2023",
             "https://formula1.lne.es/media/pilotos/medium/charles-leclerc.jpg?ttt2023",
             "https://formula1.lne.es/media/pilotos/medium/oscar-piastri.jpg?ttt2023",
             "https://formula1.lne.es/media/pilotos/medium/carlos-sainz.jpg?ttt2023",
             "https://formula1.lne.es/media/pilotos/medium/george-russell.jpg?ttt2023",
             "https://formula1.lne.es/media/pilotos/medium/lewis-hamilton.jpg?ttt2023",
             "https://formula1.lne.es/media/pilotos/medium/sergio-perez.jpg?ttt2023",
             "https://formula1.lne.es/media/pilotos/medium/fernando-alonso.jpg?ttt2023",
             "https://formula1.lne.es/media/pilotos/medium/pierre-gasly.jpg?ttt2023",
             "https://formula1.lne.es/media/pilotos/medium/nico-hulkenberg.jpg?ttt2023",
             "https://formula1.lne.es/media/pilotos/medium/yuki-tsunoda.jpg?ttt2023",
             "https://formula1.lne.es/media/pilotos/medium/lance-stroll.jpg?ttt2023",
             "https://formula1.lne.es/media/pilotos/medium/esteban-ocon.jpg?ttt2023",
             "https://formula1.lne.es/media/pilotos/medium/kevin-magnussen.jpg?ttt2023",
      "https://formula1.lne.es/media/pilotos/medium/alexander-albon.jpg?ttt2023",
      "https://formula1.lne.es/media/pilotos/medium/daniel-ricciardo.jpg?ttt2023",
      "https://soymotor.com/sites/default/files/2025-03/obearman_2025.png",
      "https://soymotor.com/sites/default/files/2025-05/franco-colapinto-2025-soymotor.png",
      "https://formula1.lne.es/media/pilotos/medium/zhou-guanyu.jpg?ttt2023",
      "https://soymotor.com/sites/default/files/2025-03/liam-lawson-racing-bulls-2025.png",
      "https://formula1.lne.es/media/pilotos/medium/valtteri-bottas.jpg?ttt2023",
      "https://image-service.zaonce.net/eyJidWNrZXQiOiJmcm9udGllci1jbXMiLCJrZXkiOiJmMW1hbmFnZXIvMjAyMy9kcml2ZXJzL2hlYWRzaG90cy9mMS9zYXIucG5nIiwiZWRpdHMiOnsicmVzaXplIjp7IndpZHRoIjo1MDB9fX0=",
      "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQjY4TG74XFl9RMqoe9Tun326jAsOi6Ubpcbg&s"))

df_pil_fotos %>% gt() %>%
  gt_theme_espn() %>%
  fmt_image(columns = foto,
            height = 40, 
            width = 40) %>%
  cols_move(columns = foto,
            after = driver) %>%
  cols_label(foto = "")
```

La temporada de F1 2024 estuvo dominada por Max Verstappen, quien se consagró campeón del mundo con amplia ventaja, mostrando un rendimiento muy superior al resto. Lando Norris sorprendió ese año siendo subcampeón gracias a su constancia y varias victorias, mientras que Charles Leclerc y Carlos Sainz aseguraron posiciones altas para Ferrari, aunque sin poder disputar el título. Mercedes mejoró respecto a años anteriores con Russell y Hamilton puntuando regularmente, y la temporada destacó por la competitividad de los equipos medianos, con McLaren y otros pilotos luchando constantemente por los puntos y podios.

<br>

### Resultado por escuderías

```{r}
df_clas_esc <- read.csv("Datos/teams.csv") %>%
  filter(year == 2024) %>%
  select(-year)

datos_esc_fotos <- df_clas_esc %>%
  mutate(
    foto = c( "https://soymotor.com/sites/default/files/styles/thumbnail_150x150/public/imagenes/equipo/logo-mclaren-f1-2021.png.webp?itok=MTryUo4O",
              "https://soymotor.com/sites/default/files/styles/thumbnail_150x150/public/imagenes/equipo/logo-ferrari-f1-2021.png.webp?itok=MPcuHAYj",
              "https://soymotor.com/sites/default/files/styles/thumbnail_150x150/public/imagenes/equipo/logos-redbull-f1-2021.png.webp?itok=mB8AzFZz",
              "https://soymotor.com/sites/default/files/styles/thumbnail_150x150/public/imagenes/equipo/logo-mercedes-f1-2021.png.webp?itok=MPcuHAYj",
              "https://soymotor.com/sites/default/files/styles/thumbnail_150x150/public/imagenes/equipo/logo-aston-martin-f1-2021.png.webp?itok=MPcuHAYj",
              "https://soymotor.com/sites/default/files/styles/thumbnail_150x150/public/imagenes/equipo/logo-alpine-f1-2021.png.webp?itok=MPcuHAYj",
              "https://soymotor.com/sites/default/files/styles/thumbnail_150x150/public/imagenes/equipo/logo-haas-f1-2021.png.webp?itok=MPcuHAYj",
              "https://soymotor.com/sites/default/files/styles/thumbnail_150x150/public/2024-01/visa-rb-soymotor.2024.png.webp?itok=DYF_trit",
              "https://soymotor.com/sites/default/files/styles/thumbnail_150x150/public/imagenes/equipo/logo-williams-f1-2021.png.webp?itok=MPcuHAYj",
              "https://soymotor.com/sites/default/files/styles/thumbnail_150x150/public/2024-01/stake-logo-2024.jpeg.webp?itok=qtF5vsPP"
  ))
  
datos_esc_fotos %>% gt() %>%
  gt_theme_espn() %>%
  fmt_image(columns = foto,
            height = 40, 
            width = 40) %>%
  cols_move(columns = foto,
            after = team) %>%
  cols_label(foto = "")

```

McLaren se coronó campeón de constructores, superando a Ferrari y Red Bull gracias al buen rendimiento de Lando Norris y Oscar Piastri. Ferrari terminó segundo con Leclerc y Sainz, mientras que Red Bull, pese a que Verstappen ganó el campeonato de pilotos, quedó tercero. Mercedes mejoró su rendimiento respecto a años anteriores, y equipos como Aston Martin y Alpine lucharon por posiciones intermedias sumando puntos de manera constante.

------------------------------------------------------------------------

## Número de GP (carreras) por año

```{r}
df_carr_año <- read.csv("Datos/ganadores_cada_carrera.csv") %>%
  filter(year != 2025) %>%
  group_by(year) %>%
  summarise(NN = n())

ggplot(df_carr_año, aes(x = year, y = NN)) +
  geom_col() +
  labs(title = "Número de Campeonatos por año",
       x = "Año", y = "Nº de Carreras",
       caption = "Fuente: FIA 2025") +
  scale_x_continuous(breaks = seq(1950, 2022, by= 3)) +
  theme_economist_white() +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust = 1))
```

En los años 50 la media de carreras por año eran de 7-8 eventos, se observa una expansión progresiva durante los 70 que encontró una fase de consolidación en las décadas de 1980 y 1990, manteniéndose estable en 16 carreras. Posteriormente, el volumen de competiciones se volvió a disparar en 2010, logrando superar las 20 GP por año en 2016, sin parar de ir a más (salvo en 2020, por la pandemia). ¿Dentro de poco superen la barrera de las 26?.

------------------------------------------------------------------------

## Pilotos y escuderías más existosas

### Escuderías con mundiales

El siguiente gráfico muestra qué escuderías han ganado más campeonatos GP en la historia (hasta 2024). Es un Treemap donde cuanto más rojo y más grande significa más éxito histórico (mayor número de premios) en la F1.

```{r}
df_clas_esc <- read.csv("Datos/teams.csv") %>%
  mutate(escuderia = case_when(str_detect(team, "Red Bull") ~ "Red Bull",
                               str_detect(team, "Brabham") ~ "Brabham Racing",
                               str_detect(team, "Cooper") ~ "Cooper Car",
                               TRUE ~ word(team, 1))) %>%
  filter(position == 1) %>%
  slice(-76) %>%
  group_by(escuderia) %>%
  count(position) %>%
  filter(n > 1) %>%
  arrange(-n)

hchart(df_clas_esc, "treemap", hcaes(x = escuderia, value = n, color = n)) %>%
hc_colorAxis(minColor = "#FFF500", maxColor = "#FF0000") %>% 
hc_size(height = 500)
```

Al observar el gráfico, destaca claramente el dominio histórico de Ferrari, que ocupa el área más grande y el color más intenso por ser el equipo con más victorias. Justo detrás aparecen otros gigantes legendarios como McLaren y Williams, que mantienen un lugar privilegiado en la historia de la competición. También se nota la fuerte presencia de escuderías más modernas como Mercedes y Red Bull, que se han consolidado entre los grandes en las últimas décadas. En definitiva, el Treemap nos muestra que, aunque han participado muchos equipos, el éxito en la Fórmula 1 se concentra en un grupo muy selecto de marcas.

<br>

### Pilotos con mayores GP

Ahora para treemap, en lugar de Mundiales ganados, tendremos en cuenta las carreras (Grandes Premios) que han ganado cada piloto.

```{r}
df_gan_car <- read.csv("Datos/ganadores_cada_carrera.csv") %>%
  group_by(winner_name) %>%
  summarise(NN = n()) %>%
  filter(NN >= 14) 

hchart(df_gan_car, "treemap", hcaes(x = winner_name, value = NN, color = NN)) %>%
hc_size(height = 500)
```

En el gráfico se ilustra perfectamente la jerarquía histórica de la Fórmula 1. Es evidente que Lewis Hamilton y Michael Schumacher destacan sobre el resto, dominando visualmente con los bloques más grandes. Sin embargo, también se aprecia cómo pilotos modernos como Verstappen o Vettel ya se codean con leyendas clásicas como Senna y Prost. En resumen, aunque hay muchos nombres en la historia, las victorias tienden a concentrarse en unas pocas 'superestrellas' que marcan su época.
 
 <br>
 
------------------------------------------------------------------------

## Evolución de la velocidad

La historia de la Fórmula 1 se caracteriza por una búsqueda constante de la velocidad. Gracias a los avances en tecnología, aerodinámica y motores, los tiempos de vuelta han disminuido drásticamente década tras década. Aunque las normativas de seguridad a veces frenan esta progresión, la innovación de los ingenieros siempre logra que los monoplazas actuales sean las máquinas más rápidas y eficientes jamás construidas. 

Para medir esta evolución de las velociadades de los coches a lo largo de la historia vamos a escoger de las pistas que mas premios han tenido y que menos modificaciones han sufrido: Mónaco, Brasil e Italia

<br>

### Mónaco

Es un circuito urbano, estrecho y sin escapatorias, donde el error se paga contra el muro. Es la pista con la velocidad media más baja de la temporada y requiere una configuración de máxima carga aerodinámica y agarre mecánico. Aquí, la potencia del motor importa menos que la tracción y la habilidad del piloto. Históricamente, es el trazado donde la sesión de clasificación es más determinante debido a la dificultad para adelantar.

```{r}
#| echo: false
my_url_monaco <- "https://upload.wikimedia.org/wikipedia/commons/thumb/3/36/Monte_Carlo_Formula_1_track_map.svg/1280px-Monte_Carlo_Formula_1_track_map.svg.png"
```


![Circuito de Mónaco](https://upload.wikimedia.org/wikipedia/commons/thumb/3/36/Monte_Carlo_Formula_1_track_map.svg/1280px-Monte_Carlo_Formula_1_track_map.svg.png){width=300}

```{r}
#| fig-width: 8
#| fig-height: 4

df_monaco <- read.csv("Datos/GrandPrix_fastest_laps_details_1950_to_2022.csv") %>%
  filter(Grand.Prix == "Monaco") %>%
mutate(Time_seconds = period_to_seconds(ms(Time)))

ggplot(df_monaco, aes(year, Time_seconds)) +
  geom_point() +
  geom_smooth() +
  labs(title = "Vuelta más rápida en cada GP de Mónaco", 
       x = "Año", y = "Tiempo (segundos)",
       caption = "FIA 2025") +
  theme_solarized() + 
  scale_y_continuous(breaks = seq(70, 120, by = 5)) +
  scale_x_continuous(breaks = seq(1950, 2022, by= 3)) +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust = 1))
```

La evolución de los tiempos en el circuito de Mónaco presenta una tendencia descendente muy clara. Como se observa en el gráfico, los monoplazas han logrado bajar los registros de forma espectacular gracias a la carga aerodinámica, a pesar de que el trazado ha sufrido reformas significativas para reducir la velocidad, como la reconfiguración de la zona de la Piscina o los cambios en la curva de la Rascasse. Sin embargo, esta evolución tiene un gran inconveniente: las modificaciones para mejorar la seguridad, sumadas al aumento progresivo del tamaño de los coches modernos, han hecho que la pista resulte extremadamente estrecha para los estándares actuales, dificultando enormemente los adelantamientos y convirtiendo la sesión de clasificación en el momento más crítico del fin de semana.

<br>

### Brasil

Un circuito clásico y muy técnico situado en São Paulo. Tiene dos particularidades clave para el análisis de datos: se corre en sentido antihorario (lo que castiga mucho el cuello de los pilotos) y tiene grandes cambios de elevación. Su trazado es una mezcla perfecta: combina un sector central muy revirado y lento con una larga subida final a fondo. Además, su clima es impredecible, lo que a menudo genera las carreras más caóticas y emocionantes en los datos históricos.

```{r}
#| echo: false
my_url_brasil <- "https://upload.wikimedia.org/wikipedia/commons/thumb/c/cf/Aut%C3%B3dromo_Jos%C3%A9_Carlos_Pace_%28AKA_Interlagos%29_track_map.svg/1280px-Aut%C3%B3dromo_Jos%C3%A9_Carlos_Pace_%28AKA_Interlagos%29_track_map.svg.png"
```


![Circuíto de Interlagos](https://upload.wikimedia.org/wikipedia/commons/thumb/c/cf/Aut%C3%B3dromo_Jos%C3%A9_Carlos_Pace_%28AKA_Interlagos%29_track_map.svg/1280px-Aut%C3%B3dromo_Jos%C3%A9_Carlos_Pace_%28AKA_Interlagos%29_track_map.svg.png){width=300}

```{r}
#| fig-width: 8
#| fig-height: 4

df_brasil <- read.csv("Datos/GrandPrix_fastest_laps_details_1950_to_2022.csv") %>%
  filter(Grand.Prix == "Brazil",
         year >= 1990) %>%
  mutate(Time_seconds = period_to_seconds(ms(Time)))

ggplot(df_brasil, aes(year, Time_seconds)) +
  geom_point() +
  geom_smooth() +
  labs(title = "Vuelta más rápida en cada GP de Brasil", 
       x = "Año", y = "Tiempo (segundos)",
       caption = "FIA 2025") +
  theme_solarized() + 
  scale_y_continuous(breaks = seq(70, 86, by = 2)) +
  scale_x_continuous(breaks = seq(1990, 2022, by= 2)) +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust = 1))
```

Si bien la tendencia general desde 1990 es de una reducción de los tiempos —pasando de rondar los 80 segundos a bajar hasta la barrera de los 70 segundos—, la gráfica muestra claramente cómo los cambios en la normativa técnica han impactado en el rendimiento. Se observa un descenso vertiginoso hasta el año 2004 (la era de los motores V10), seguido de un repunte donde los coches se volvieron más lentos a principios de la década de 2010. Sin embargo, la maduración de la tecnología híbrida actual ha permitido recuperar esa velocidad perdida, volviendo a situar los registros en mínimos históricos en los últimos años.

<br>

### Italia

Conocido mundialmente como el "Templo de la Velocidad". Es el circuito más rápido del calendario, caracterizado por sus largas rectas y curvas rápidas (como la Parabólica). Para los ingenieros, es un desafío de baja carga aerodinámica: los coches se configuran con alerones muy planos para maximizar la velocidad punta, sacrificando agarre en las curvas. Es el escenario ideal para analizar la potencia pura de los motores.

```{r}
#| echo: false
my_url_italia <- "https://upload.wikimedia.org/wikipedia/commons/thumb/f/f8/Monza_track_map.svg/2560px-Monza_track_map.svg.png"
```

![Circuito de Monza](https://upload.wikimedia.org/wikipedia/commons/thumb/f/f8/Monza_track_map.svg/2560px-Monza_track_map.svg.png){width=300}

```{r}
#| fig-width: 8
#| fig-height: 4

df_italia <- read.csv("Datos/GrandPrix_fastest_laps_details_1950_to_2022.csv") %>%
  filter(Grand.Prix == "Italy") %>%
  mutate(Time_seconds = period_to_seconds(ms(Time)))

ggplot(df_italia, aes(year, Time_seconds)) +
  geom_point() +
  geom_smooth() +
  labs(title = "Vuelta más rápida en cada GP de Italia", 
       x = "Año", y = "Tiempo (segundos)",
       caption = "FIA 2025") +
  theme_solarized() + 
  scale_y_continuous(breaks = seq(70, 120, by = 5)) +
  scale_x_continuous(breaks = seq(1950, 2022, by= 3)) +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust = 1)) 
```

El análisis histórico de las vueltas rápidas en el Autódromo de Monza confirma su estatus como el 'Templo de la Velocidad'. La gráfica muestra una caída vertiginosa en los tiempos de vuelta, pasando de superar los 110 segundos en la década de 1950 a estabilizarse en torno a los 75 segundos en la actualidad. Lo más destacable de esta tendencia es que la reducción de tiempos se ha mantenido constante a pesar de la introducción de variantes y 'chicanes' destinadas a frenar los coches por seguridad. Esto demuestra que el desarrollo aerodinámico y la potencia de las unidades de potencia modernas han logrado superar cualquier restricción física del trazado, convirtiendo a Monza en el escenario de los promedios de velocidad más altos de la historia.

------------------------------------------------------------------------

## Comparación de los Pit-Stops

En la Fórmula 1 contemporánea, los pit stops han trascendido su función original de mantenimiento para convertirse en un elemento estratégico decisivo. Lejos de ser una simple pausa técnica, la parada en boxes representa una oportunidad táctica para ganar posición respecto a los rivales mediante maniobras como el undercut. Además, la ejecución técnica de la parada, que en la actualidad ronda los 2 a 3 segundos, pone a prueba la precisión y coordinación del equipo de mecánicos. Por tanto, el éxito en una carrera no solo depende de la velocidad pura del monoplaza en pista, sino de la capacidad de los ingenieros para elegir el momento exacto de la detención y de la eficiencia humana en el cambio de neumáticos. 

Para ver la evolución de los pit-stops stops tomaremos los más rápidos en tres circuitos diferentes, donde esta maniobra cobra mucha importancia: Bahrein, España y Singapur, además consideraremos los distintos protocolos que se han puesto en el reglamento (como se puede ver en el código)

```{r}
#| fig-width: 6
#| fig-height: 4

df_pit_stops <- read.csv("Datos/f1_pit_stop_summary.csv") %>%
  select(-(3:7), -(12:22)) %>%
  mutate(time_clean = case_when(
      str_detect(time, ":") ~ period_to_seconds(ms(time)),
      TRUE ~ as.numeric(time))) %>%
  group_by(track, year) %>%
  slice_min(time_clean, n = 1) %>%
  mutate(protocolo = case_when(
    year == 2005 ~ "Prohibido cambio neumáticos",
    year >= 1994 & year <= 2009 ~ "Era de Repostaje (Gasolina)",
    year >= 2010 & year <= 2021 ~ "Solo Neumáticos (Slicks)",
    year >= 2022 ~ "Llantas 18 pulgadas",
    TRUE ~ "Otras Eras"))
```

<br>

### Bahrein

```{r}
#| fig-width: 6
#| fig-height: 4

df_pit_bahrain <- df_pit_stops %>%
  filter(track == "bahrain") 

p1 <- ggplot(df_pit_bahrain, aes(year, time_clean, fill = protocolo)) +
  geom_bar(stat = "identity") +
  scale_fill_manual(values = c(
    "Prohibido cambio neumáticos" = "#E41A1C",
    "Era de Repostaje (Gasolina)" = "#FF7F00",
    "Solo Neumáticos (Slicks)"    = "#377EB8",
    "Llantas 18 pulgadas"         = "#4DAF4A")) +
  theme(legend.position = "none") +
  labs(title = "Parada más rápida en el GP de Bahrein por año", 
       x = "Año", y = "Tiempo (segundos)",
       caption = "FIA 2025")

p1
```

<br>

### Singapur

```{r}
#| fig-width: 6
#| fig-height: 4

df_pit_singapur <- df_pit_stops %>%
  filter(track == "singapore") 

p2 <- ggplot(df_pit_singapur, aes(year, time_clean, fill = protocolo)) +
  geom_bar(stat = "identity") +
  scale_fill_manual(values = c(
    "Prohibido cambio neumáticos" = "#E41A1C",
    "Era de Repostaje (Gasolina)" = "#FF7F00",
    "Solo Neumáticos (Slicks)"    = "#377EB8",
    "Llantas 18 pulgadas"         = "#4DAF4A")) +
  theme(legend.position = "none") +
  labs(title = "Parada más rápida en el GP de Singapur por año", 
       x = "Año", y = "Tiempo (segundos)",
       caption = "FIA 2025")

p2
```

<br>

### España

```{r}
df_pit_espana <- df_pit_stops %>%
  filter(track == "spain") 

p3 <- ggplot(df_pit_espana, aes(year, time_clean, fill = protocolo)) +
  geom_bar(stat = "identity") +
  scale_fill_manual(values = c(
    "Prohibido cambio neumáticos" = "#E41A1C",
    "Era de Repostaje (Gasolina)" = "#FF7F00",
    "Solo Neumáticos (Slicks)"    = "#377EB8",
    "Llantas 18 pulgadas"         = "#4DAF4A")) +
  theme(legend.position = "none") +
  labs(title = "Parada más rápida en el GP de España por año", 
       x = "Año", y = "Tiempo (segundos)",
       caption = "FIA 2025")

p3
```

<br>

```{r}
diseño_final <- (((p1 + labs(title = NULL)) + (p2 + labs(title = NULL))) / (p3 + labs(title = NULL))) +
plot_annotation(
    title = "Evolución de los Pit Stops en distintos circuitos",
    subtitle = "Comparativa entre Bahréin, Singapur y España, respectivamente",
    caption = "FIA 2025")  

diseño_final
```

La comparativa de los tiempos de pit stop entre los Grandes Premios de España, Singapur y Baréin confirma patrones comunes dictados por el reglamento, pero con diferencias notables debidas a la infraestructura de cada pista. En los tres casos se observa la transición de la inestabilidad de la época de repostajes (barras naranjas) hacia la regularidad de la era moderna. No obstante, el gráfico destaca una divergencia crucial en la duración total: mientras que en España y Baréin las paradas modernas se estabilizan en el rango de los 20 a 24 segundos, en Singapur (abajo a la izquierda) los tiempos son sistemáticamente superiores, rozando los 30 segundos. Esta anomalía se explica por la naturaleza urbana del circuito de Marina Bay, cuyo carril de boxes es más largo y sinuoso, lo que obliga a los pilotos a transitar a velocidad limitada durante más tiempo que en autódromos permanentes como Montmeló o Sakhir.

------------------------------------------------------------------------

## Títulos por países

Por último, vamos a crear un mapa de coropletes en función de los títulos mundiales que ostenta cada país para visualizar la distribución geográfica del éxito en la Fórmula 1. Este tipo de gráfico nos permitirá identificar, mediante una escala de intensidad de color, qué naciones han dominado históricamente la competición —como Reino Unido, Alemania o Brasil— y contrastarlas con aquellas que han tenido una presencia más testimonial.

```{r}
df_nat_pil <- read.csv("Datos/drivers.csv") %>%
  filter(year < 2025,
         position == 1) %>%
  arrange(year) %>%
  mutate(nationality = case_when(
    nationality == "NED" ~ "NLD",
    nationality == "MON" ~ "MCO",
    nationality == "SUI" ~ "CHE",
    TRUE ~ nationality
  ))

world <- rnaturalearth::ne_countries(scale = "medium", returnclass = "sf")

world_final <- world %>% 
  select(name, iso_a3, geometry) %>% 
  left_join(df_nat_pil, by = c("iso_a3" = "nationality")) %>%
  filter(position == 1) %>%
  group_by(name) %>%
  count(position == 1)%>%
  mutate(rango_campeones = case_when(
    n == 0 | is.na(n) ~ "Sin títulos",
    n >= 1 & n < 2   ~ "1 Mundiales",
    n >= 2 & n < 3   ~ "2 Mundiales",
    n >= 3 & n <= 4  ~ "3-4 Mundiales",
    n >= 5 & n <= 8  ~ "5-8 Mundiales",
    n > 8 ~ "Reino Unido"))

p13 <- ggplot(world_final) +
  geom_sf(aes(fill = rango_campeones)) +
  scale_fill_manual(
    values = c(
      "Sin títulos"             = "#D3D3D3",   
      "1 Mundiales"           = "#FF0000",  
      "2 Mundiales"           = "#6BAED6",  
      "3-4 Mundiales"         = "#00FF00",
      "5-8 Mundiales"           = "#FFFF00",
      "Reino Unido"           = "#804000")) +
  theme_void() +
    theme( legend.position = "bottom",
           legend.direction = "vertical",
           legend.key.size = unit(0.4, "cm"),
           legend.text = element_text(size = 8),
           legend.title = element_text(size = 9, face = "bold")) +
  labs(
    title = "Distribución mundial del Éxito en la Fórmula 1",
    fill = "Total de Títulos",
    caption = "Fuente: FIA 2025")

p13
```

El mapa de coropletes ilustra la jerarquía histórica de la Fórmula 1, revelando una clara hegemonía del Reino Unido como la máxima potencia del automovilismo mundial. La distribución de colores evidencia una fuerte concentración del éxito en Europa y Sudamérica, donde países como Brasil, Alemania o Argentina destacan sobre el resto. Esta visualización confirma que, a pesar de ser un deporte global, la élite de campeones sigue estando centralizada en un grupo selecto de naciones tradicionales.